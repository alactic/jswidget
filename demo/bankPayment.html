<html>
<head>
    <title>BaseOne</title>
    <link rel="stylesheet" href="bankPayment.css">
    <link rel="stylesheet" href="paymentPlan.css">
    <link rel="stylesheet" href="bankTransfer.css">
    <link rel="stylesheet" href="transactionFeedback.css">
    <link rel="stylesheet" href="transaction-loading.css">
    <script src="widget.js" type="application/javascript"></script>
    <script>
        var reference = "";
        var publicKey = "";
        function initializatonWidget(){
            document.getElementById( 'bank-payment-container-iitg33405-fgti594' ).style.display = 'none';
            document.getElementById( 'transfer-container-495gjjhg-gkhkhjg' ).style.display = 'flex';
        }

        function initialise(){
            var url = new URL(window.location.href);
            var dataPayload = url.searchParams.get("data");
            const imageUrl = JSON.parse(dataPayload).imageUrl;
            publicKey = JSON.parse(dataPayload).publicKey;
            document.getElementById("logo").src= imageUrl;
            document.getElementById("logo2").src= imageUrl;
            document.getElementById("logo3").src= imageUrl;
            document.getElementById("logo4").src= imageUrl;
            document.getElementsByClassName("logo-icon")[0].src= imageUrl;

            fetch('https://afcollectionaggregatortest.azurewebsites.net/api/v1/initialize', {
            method: 'POST',
            headers: {
            'Accept': 'application/json',
            'Content-Type': 'application/json',
            "Api-Key": publicKey
            },
            body: dataPayload
            })
            .then(response => response.json())
            .then(res => {
            if(!res.requestSuccessful){
                document.getElementsByClassName("transaction-feedback-container-iitg33405-fgti594")[0].style.display="flex"
                document.getElementsByClassName("transaction-message-items")[0].style.display="none"
                document.getElementsByClassName("transaction-failed-message-items")[0].style.display="flex"
                document.getElementsByClassName("message-desc")[0].innerHTML=res.message;
            }else{
                reference = res.responseData.transactionReference
                document.getElementById( 'transfer-container-495gjjhg-gkhkhjg' ).style.display = 'flex';
            }
            document.getElementsByClassName("transaction-loading-container-iitg33405-fgti594")[0].style.display="none"
           }).catch(error => {
               console.log({error});
           })            
                        
        }

        function pay(){
            document.getElementsByClassName("loader")[0].style.display="inline-block"
            fetch('https://jsonplaceholder.typicode.com/todos/1')
            .then(response => response.json())
            .then(json => {
          var url = new URL(window.location.href);
            var c = url.searchParams.get("data");
            console.log(JSON.parse(c).token);
            
            document.getElementsByClassName("loader")[0].style.display="none"
           })      
        }

        function validateTransfer(){
            document.getElementsByClassName("transaction-loading-container-iitg33405-fgti594")[0].style.display="flex";
            document.getElementsByClassName( 'transfer-container-495gjjhg-gkhkhjg' )[0].style.display = 'none';

            fetch(`https://afcollectionaggregatortest.azurewebsites.net/api/v1/validate?transactionReference=${reference}`, {
            method: 'POST',
            headers: {
            'Accept': 'application/json',
            'Content-Type': 'application/json',
            "Api-Key": publicKey
            },
            body: null
            })
            .then(response => response.json())
            .then(res => {
                const status = res.responseData.transactionStatus
                if(status !== "Processing"){
                    if(status !== "Success"){
                        document.getElementsByClassName("transaction-feedback-container-iitg33405-fgti594")[0].style.display="flex"
                        document.getElementsByClassName("transaction-message-items")[0].style.display="none"
                        document.getElementsByClassName("transaction-failed-message-items")[0].style.display="flex"
                        document.getElementsByClassName("message-desc")[0].innerHTML=res.message==="Successful"?"Failed":res.message
                    }else{
                        document.getElementsByClassName("transaction-feedback-container-iitg33405-fgti594")[0].style.display="flex"
                        document.getElementsByClassName("transaction-message-items")[0].style.display="flex"
                        document.getElementsByClassName("transaction-failed-message-items")[0].style.display="none"
                        document.getElementsByClassName("amount")[0].innerHTML=res.message
                        document.getElementsByClassName("currency")[0].innerHTML=res.message
                        document.getElementById("bank-name").innerHTML=res.message
                        document.getElementById("account-number").innerHTML=res.message
                        document.getElementsByClassName("message-desc")[0].innerHTML=res.message
                    }
                    document.getElementsByClassName("transaction-loading-container-iitg33405-fgti594")[0].style.display="none"
                }else{
                   setTimeout(() => validateTransfer(), 15000)
                }
            
           }).catch(error => {
               console.log({error});
           })
            // document.getElementById( 'bank-transfer-iitg33405-fgti594' ).style.display = 'none';
            // // document.getElementById( 'transaction-feedback-fgti594' ).style.display = 'flex';  
            // document.getElementById( 'transaction-message-fgti594' ).style.display = 'flex';  
               
        }
        function initializeBankPayment(){
            document.getElementById( 'transfer-container-495gjjhg-gkhkhjg' ).style.display = 'none';
            document.getElementById( 'bank-payment-container-iitg33405-fgti594' ).style.display = 'flex';
        }
        function bankTransfer(){
            document.getElementsByClassName("transaction-loading-container-iitg33405-fgti594")[0].style.display="flex";
            document.getElementsByClassName( 'transfer-container-495gjjhg-gkhkhjg' )[0].style.display = 'none';

            fetch(`https://afcollectionaggregatortest.azurewebsites.net/api/v1/Transfer/${reference}`, {
            method: 'POST',
            headers: {
            'Accept': 'application/json',
            'Content-Type': 'application/json',
            "Api-Key": publicKey
            },
            body: JSON.stringify({
                "additionalProp1": null,
                "additionalProp2": null,
                "additionalProp3": null
                })
            })
            .then(response => response.json())
            .then(res => {
                console.log({res})
                const {TotalAmount, BankName, AccountNumber, ProviderMessage, ExpiryTime} = res.responseData
            if(!res.requestSuccessful){
                document.getElementsByClassName("transaction-feedback-container-iitg33405-fgti594")[0].style.display="flex"
                document.getElementsByClassName("transaction-message-items")[0].style.display="none"
                document.getElementsByClassName("transaction-failed-message-items")[0].style.display="flex"
                document.getElementsByClassName("message-desc")[0].innerHTML=res.message
            }else{
                document.getElementsByClassName( 'bank-transfer-container-iitg33405-fgti594' )[0].style.display = 'flex';
                document.getElementsByClassName("amount")[0].innerHTML=TotalAmount
                // document.getElementsByClassName("currency")[0].innerHTML=res.message
                document.getElementsByClassName("amount")[1].innerHTML=TotalAmount
                // document.getElementsByClassName("currency")[1].innerHTML=res.message
                document.getElementById("bank-name").innerHTML=BankName
                document.getElementById("account-number").innerHTML=AccountNumber
                document.getElementById("expiryTime").innerHTML=ExpiryTime
                document.getElementsByClassName("message-desc")[0].innerHTML=res.message

            }
            document.getElementsByClassName("transaction-loading-container-iitg33405-fgti594")[0].style.display="none"
           }).catch(error => {
               console.log({error});
           })
            // document.getElementById( 'transfer-container-495gjjhg-gkhkhjg' ).style.display = 'none';
            // document.getElementById( 'bank-transfer-iitg33405-fgti594' ).style.display = 'flex';
        }
        function closeModal(){       
            closePaymentWidget();
        }
    </script>
</head>
<body class="content" onload="initialise()">
    <div id="transfer-container-495gjjhg-gkhkhjg" class="transfer-container-495gjjhg-gkhkhjg">
        <div class="transfer-content">
        <div class="transfer-header">
            <div class="transfer-header-icons">
                <img src="" onclick="closeModal()" id="logo" class="logo-icon" alt="icon"/>
                <img src="./assets/cancel-icon-white.png" onclick="closeModal()" class="cancel-icon" alt="icon"/>
            </div>
            <div class="transfer-header-text">How would you like to pay NGN 1000?</div>
        </div>
        <div class="transfer-options">
            <div class="transfer-option" onclick="initializeBankPayment()">
                <div class="option">
                    <div class="transfer-icon"><img src="./assets/card-icon.jpg" alt="icon"/></div>
                    <div>Card Payment</div>
                </div>
                <img src="./assets/arrow-right.jpg" alt="arrow"/>
            </div>
            <!-- <div class="transfer-option">
                <div class="option">
                    <div class="transfer-icon"><img src="./assets/ussd.jpg" alt="icon"/></div>
                    <div>USSD</div>
                </div>
                <img src="./assets/arrow-right.jpg" alt="arrow"/>
            </div> -->
            <div class="transfer-option" onclick="bankTransfer()">
                <div class="option">
                    <div class="transfer-icon"><img src="./assets/bank-icon.jpg" alt="icon"/></div>
                    <div>Bank Transfer</div>
                </div>
                <img src="./assets/arrow-right.jpg" alt="arrow"/>
            </div>
            <div class="secure-baseone">
                <img src="./assets/secure-icon.jpg" alt="icon"/>Secured by &nbsp;<b>Baseone</b>
            </div>
        </div>
     </div>
     </div>
    
            
    <div id="bank-payment-container-iitg33405-fgti594" class="bank-payment-container-iitg33405-fgti594">
        <div class="bank-payment-content">
        <div class="bank-payment-header">
            <img src="" onclick="closeModal()" id="logo" class="logo-icon" alt="icon"/>
            <img src="./assets/cancel-icon.png" onclick="closeModal()" class="cancel-icon" alt="icon"/>
        </div>
       <div class="bank-payment-items">
        <div class="payment-title">Enter your card details</div>
        <div>
            <label>Card Number</label>
            <div>
                <input placeholder="0000 0000 0000 0000"/>
            </div>
        </div>
        <div class="d-flex">
            <div class="expiry">
                <label>Expiry Date</label>
                <div>
                    <input placeholder="MM / YY"/>
                </div>
            </div>
            <div class="cvv">
                <label>CVV</label>
                <div>
                    <input placeholder="123"/>
                </div>
            </div>
        </div>
        <div>
            <button class="pay-button" onclick="pay()">Pay 1000 NGN <div class="loader"></div></button>
            <div class="change-payment" onclick="initializatonWidget()">Change Payment Method</div>
        </div>
       </div>
        </div>
    </div>

    <div id="bank-transfer-iitg33405-fgti594" class="bank-transfer-container-iitg33405-fgti594">
        <div class="bank-transfer-content">
        <div class="bank-transfer-header">
            <img src="" onclick="closeModal()" id="logo4" class="logo-icon" alt="icon"/>
            <img src="./assets/cancel-icon.png" onclick="closeModal()" class="cancel-icon" alt="icon"/>
        </div>
        <div class="payment-title">
            <div class="see-details">See details below</div>
            <div class="pay">Pay <span class="amount">4000</span><span class="currency">NGN</span></div>
        </div>
       <div class="bank-transfer-items">
        
        <div class="send-to">
            Send <b><span class="currency">NGN</span><span class="amount">4000</span></b> to <br/>Baseone checkout
        </div>
        <div class="transfer-info">
        <div id="bank-name">Wema Bank</div>
        <div id="account-number">760934590</div>
        <div class="desc">
            Use this account for this transaction only.</br/>
            Account expires in <b><span id="expiryTime">30</span> mins</b>
        </div>
        </div>
        <div>
            <button class="pay-button" onclick="validateTransfer()">I’ve sent the money</button>
         </div>
       </div>
        </div>
    </div>

    <div id="transaction-feedback-fgti594" class="transaction-loading-container-iitg33405-fgti594">
        <div class="transaction-feedback-content">
            <div class="bank-transfer-header">
                <img src="" onclick="closeModal()" id="logo2" class="logo-icon" alt="icon"/>
                <img src="./assets/cancel-icon.png" onclick="closeModal()" class="cancel-icon" alt="icon"/>
            </div>
            <div class="content">
                <div class="description">
                    <div class="content-loader"></div>
                    Please wait while your transaction 
                    is in progress..
                </div>
                <div class="secure-baseone">
                    <img src="./assets/secure-icon.jpg" alt="icon"/>Secured by &nbsp;<b>Baseone</b>
                </div>
            </div>
        </div>
        
    </div>

    <div id="transaction-message-fgti594" class="transaction-feedback-container-iitg33405-fgti594">
        <div class="transaction-feedback-content">
            <div class="bank-transfer-header">
                <img src="" onclick="closeModal()" id="logo3" class="logo-icon" alt="icon"/>
                <img src="./assets/cancel-icon.png" onclick="closeModal()" class="cancel-icon" alt="icon"/>
            </div>
            <div class="transaction-failed-message-items">
                <div class="message-icon">
                    <div class="message-icon-failed">
                        <img src="./assets/failed.png" alt="icon"/>
                    </div>
                </div>
                <div class="message-title">Transaction Failed</div>
                <div class="message-desc">Your transaction failed, please 
                    try again!</div>
                <div>
                    <button class="close-button" onclick="closeModal()">Close</button>
                </div>
            </div>
            <div class="transaction-message-items">
                <div class="message-icon">
                    <div class="message-icon-success">
                        <img src="./assets/success.png" alt="icon"/>
                    </div>
                </div>
                <div class="message-title">Successful</div>
                <div class="message-desc">Your payment was completed successfully</div>
                <div>
                    <button class="pay-button" onclick="pay()">Done</button>
                </div>
            </div>
       </div>
        </div>
    </div>

</body>
</html>